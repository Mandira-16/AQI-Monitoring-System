@model AQI_Monitoring_System.Models.SimulationConfig

@{
	ViewData["Title"] = "Configure Simulation";
}

<title>Configure Simulation</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link rel="stylesheet" href="~/css/ConfigSimulationStyleSheet.css" />

<div class="container">
	<div class="row justify-content-center">
		<div class="col-md-6">
			<div class="card dashboard-card mt-4">
				<div class="card-header">
					<h4 class="text-center m-0">
						<i class="bi bi-gear me-2"></i>Configure Simulation Parameters
					</h4>
				</div>
				<div class="card-body">
					@if (TempData["SuccessMessage"] != null)
					{
						<div class="alert alert-success">
							<i class="bi bi-check-circle me-2"></i>@TempData["SuccessMessage"]
						</div>
					}

					<h5 class="section-heading">
						<i class="bi bi-sliders me-2"></i>Simulation Settings
					</h5>
					<p class="mb-4">Define the parameters that control how AQI data is simulated across all sensors.</p>

					<form id="simulationConfigForm" asp-action="ConfigureSimulation" method="post">
						<input type="hidden" asp-for="Id" />

						<div class="parameter-card">
							<div class="d-flex align-items-center mb-2">
								<i class="bi bi-clock me-3"></i>
								<h6 class="mb-0">Time Interval</h6>
							</div>
							<div class="mb-3">
								<label asp-for="FrequencyMinutes" class="form-label">Frequency (minutes)</label>
								<input asp-for="FrequencyMinutes" class="form-control" />
								<span asp-validation-for="FrequencyMinutes" class="text-danger"></span>
								<small class="form-text text-muted">
									<i class="bi bi-info-circle me-1"></i>Data generation interval (1-60 minutes).
								</small>
							</div>
						</div>

						<div class="parameter-card">
							<div class="d-flex align-items-center mb-2">
								<i class="bi bi-graph-up me-3"></i>
								<h6 class="mb-0">AQI Configuration</h6>
							</div>
							<div class="mb-3">
								<label asp-for="BaselineAqi" class="form-label">Baseline AQI</label>
								<input asp-for="BaselineAqi" class="form-control" />
								<span asp-validation-for="BaselineAqi" class="text-danger"></span>
								<small class="form-text text-muted">
									<i class="bi bi-info-circle me-1"></i>Starting AQI value (0-500).
								</small>
							</div>
						</div>

						<div class="parameter-card">
							<div class="d-flex align-items-center mb-2">
								<i class="bi bi-arrow-up-down me-3"></i>
								<h6 class="mb-0">Data Variation</h6>
							</div>
							<div class="mb-3">
								<label asp-for="VariationRange" class="form-label">Variation Range</label>
								<input asp-for="VariationRange" class="form-control" />
								<span asp-validation-for="VariationRange" class="text-danger"></span>
								<small class="form-text text-muted">
									<i class="bi bi-info-circle me-1"></i>Max deviation from baseline (0-500).
								</small>
							</div>
						</div>

						<div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
							<button type="submit" class="btn btn-primary">
								<i class="bi bi-save me-2"></i>Save Changes
							</button>
							<a asp-action="MonitorAdminDashboard" class="btn btn-secondary">
								<i class="bi bi-x-circle me-2"></i>Cancel
							</a>
						</div>
					</form>
				</div>
			</div>

			<div class="text-center mt-3 mb-5">
				<a asp-action="MonitorAdminDashboard" class="btn btn-outline-primary">
					<i class="bi bi-arrow-left me-2"></i>Back to Dashboard
				</a>
			</div>
		</div>
	</div>
</div>
@section Scripts {
	<script src="~/lib/jquery/dist/jquery.min.js"></script>
	<script src="~/lib/jquery-validation/dist/jquery.validate.js"></script>
	<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>

	<script>
		$(document).ready(function () {
			console.log("jQuery loaded successfully: " + $.fn.jquery);
			console.log("jQuery validation loaded: " + ($.validator ? "Yes" : "No"));
			console.log("jQuery validation unobtrusive loaded: " + ($.validator.unobtrusive ? "Yes" : "No"));

			// Re-parse the specific form to apply validation
			if ($.validator && $.validator.unobtrusive) {
				console.log("Parsing form for validation...");
				$.validator.unobtrusive.parse("#simulationConfigForm");

				// Debug: Log when validation is triggered
				$("#simulationConfigForm").validate({
					debug: true, // Enable jQuery Validation debug mode
					errorPlacement: function (error, element) {
						console.log("Validation error for " + element.attr("name") + ": " + error.text());
						error.insertAfter(element); // Ensure errors are placed correctly
					}
				});

				// Trigger validation on input change or keyup
				$("#simulationConfigForm input").on("change keyup", function () {
					console.log("Triggering validation for: " + $(this).attr("name"));
					$(this).valid();
				});
			} else {
				console.warn("Unobtrusive validation not loaded, skipping form parse.");
			}
		});
	</script>
}
